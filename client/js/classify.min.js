/*!
 * Classify JavaScript Library v0.9.10
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Fri, 29 Jun 2012 00:54:13 GMT
 */;(function(e,t){"use strict";var n="prototype",r=!{toString:null}.propertyIsEnumerable("toString"),i=r?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],s=i.length,o=Object[n],u=o.toString,a=o.hasOwnProperty,f=function(e){return typeof e=="function"},l=function(e){return e&&e[n]&&u.call(e)==="[object Function]"},c=Array.isArray||function(e){return u.call(e)==="[object Array]"},h=/^\s*function\s+.+?\(.*?\)\s*\{\s*\[native code\]\s*\}\s*$/,p=function(e){return f(e)&&h.test(e+"")},d=function(e){var t=[],n;for(n in e)t[t.length]=n;if(r)for(n=0;n<s;++n)a.call(e,i[n])&&(t[t.length]=i[n]);return t},v=function(e){return c(e)?e:[e]},m=function(e){return Array[n].slice.call(e,0)},g=Array[n].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n=0,r=e.length;for(;n<r;++n)if(e[n]===t)return n;return-1},y=function(e,t){return e.__original_=t,e},b=function(e,n,r){if(!e)return e;var i,s=0,o=e.length;if(o===t||f(e)){for(i in e)if(n.call(r||e[i],e[i],i,e)===!1)break}else for(i=e[0];s<o;i=e[++s])if(n.call(r||i,i,s,e)===!1)break;return e},w=function(e,t){var n=[];return b(e,function(r,i){n[n.length]=t(r,i,e)}),n},E=function(e,t){var n=[];return b(e,function(e){e!==t&&(n[n.length]=e)}),n},S=function(){var e=m(arguments),t=e.shift();return b(e,function(e){b(d(e),function(n){t[n]=e[n]})}),t},x=/^(?:superclass|subclass|implement|observable|bindings|extend|prototype|applicate|(?:add|remove)(?:Static|Observable|Aliased|Bound)Property)$/,T={},N=[],C=[],k=[],L=[],A=[N,C,k,L],O=["onCreate","onPropAdd","onPropRemove","onInit"],M=p(Object.create)?Object.create:function(e,t){var r=function(){};return r[n]=e,new r},_=function(e,t,n){e[t]=n},D=function(){var e=function(){};return e[n].init=function(){},e.superclass=null,e.subclass=[],e.implement=[],e[n].constructor=D,e[n].self=D,e.__isclass_=!0,e}(),P=function(e,n){return y(function(){var r=this.parent,i;return this.parent=e,i=n.apply(this,arguments),r===t?delete this.parent:this.parent=r,i},n)},H=function(e,t){if(T[e])throw Error('Adding duplicate mutator "'+e+'".');T[e]=t,t.name=e,t.propTest=RegExp("^__"+e+"_"),t.propPrefix="__"+e+"_",b(O,function(e,n){t[e]&&A[n].push(t)})},B=function(e){var t=T[e];if(!t)throw Error("Removing unknown mutator.");b(O,function(e,n){if(t[e]){var r=g(A[n],t);r>-1&&A[n].splice(r,1)}}),T[e]=null;try{delete T[e]}catch(n){}},j=function(e,t,r,i){if(i===o[r])return;var s=!1;b(C,function(n){if(n.propTest.test(r))return r===n.propPrefix?b(i,function(r,i){n.onPropAdd.call(n,e,t,i,r)}):n.onPropAdd.call(n,e,t,r.replace(n.propTest,""),i),s=!0,!1});if(s)return;var u=t[n][r],a=e[n];_(a,r,f(i)&&!i.__isclass_&&f(u)?P(u,i):i),f(i)&&b(e.subclass,function(e){f(e[n][r])&&!e[n][r].__original_&&_(e[n],r,P(a[r],e[n][r]))})},F=function(e,t){var r=!1;b(k,function(n){if(n.propTest.test(t))return n.onPropRemove.call(n,e,t.replace(n.propTest,"")),r=!0,!1});if(r)return;if(!f(e[n][t])){e[n][t]=null;try{delete e[n][t]}catch(i){}return}b(e.subclass,function(e){e[n][t]&&f(e[n][t])&&f(e[n][t].__original_)&&_(e[n],t,e[n][t].__original_)}),e[n][t]=null;try{delete e[n][t]}catch(i){}},I=function(){var e=D,r={},i=[],s=arguments,o=s.length,u,h;return o===1?r=s[0]:o===2?(!s[0].__isclass_&&!l(s[0])?i=v(s[0]):e=s[0],r=s[1]):(e=s[0],i=v(s[1]),r=s[2]),r=S({},r),!e.__isclass_&&!r.init&&(r.init=e),u=function(){var e,n,r;if(!this||!this.init||!(this instanceof u))return u.invoke.apply(u,arguments);for(n=0,r=L.length;n<r;n++)L[n].onInit.call(L[n],this,u);e=this.init.apply(this,arguments);if(e!==t)return e},delete r.applicate,u.applicate=function(e){var t=function(){return u.apply(this,e)};return t[n]=u[n],new t},u.invoke=r.invoke||(e.invoke&&f(e.invoke)&&!e.invoke.__original_?e.invoke:null)||y(function(){return u.applicate(arguments)},!0),delete r.invoke,u.superclass=e,u.subclass=[],u.implement=(c(e.implement)?e.implement:[]).concat(i),h=u[n]=M(e[n]),u.extend=h.extend=function(){return I.apply(null,[u].concat(m(arguments)))},e.subclass&&c(e.subclass)&&e.subclass.push(u),r.invoke=function(t,r){if(t in e[n]&&t!=="invoke"&&f(e[n][t])){var i=this.invoke,s;return this.invoke=e[n].invoke,s=e[n][t].apply(this,r||[]),this.invoke=i,s}throw Error('Function "'+t+'" of parent class being invoked is undefined.')},u.addProperty=function(n,r,i){return i=i||"",r===t?b(d(n),function(t){j(u,e,i+t,n[t])}):j(u,e,i+n,r),u},u.removeProperty=function(e){return F(u,e),u},i.length!==0&&b(i,function(e){var t=e.__isclass_?e[n]:e;b(d(t),function(e){!a.call(h,e)&&!a.call(r,e)&&(r[e]=t[e])})}),b(N,function(t){t.onCreate.call(t,u,e)}),u.addProperty(r),h.constructor=u,h.self=u,u.__isclass_=!0,u};H("static",{onCreate:function(e,t){var n=this.propPrefix;e.addStaticProperty=function(t,r){return e.addProperty(t,r,n)},e.removeStaticProperty=function(t){return e.removeProperty(n+t)}},onPropAdd:function(e,t,n,r){if(x.test(n))return;_(e,n,f(r)&&!r.__isclass_?y(function(){return r.apply(e,arguments)},r):r)},onPropRemove:function(e,t){if(x.test(t))return;e[t]=null;try{delete e[t]}catch(n){}}}),H("nowrap",{onCreate:function(e,t){var n=this.propPrefix;e.addUnwrappedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,r,i){_(e[n],r,i)}}),H("alias",{onCreate:function(e,t){var n=this.propPrefix;e.addAliasedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,n,r){j(e,t,n,function(){return this[r].apply(this,arguments)})}}),H("bind",{onCreate:function(e,t){var n=this;e.bindings=(t.bindings||[]).slice(0),e.addBoundProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeBoundProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){var i=g(e.bindings,n);i<0&&f(r)&&!r.__isclass_&&e.bindings.push(n),j(e,t,n,r)},onPropRemove:function(e,t){var r=g(e.bindings,t);if(r<0)return;e.bindings.splice(r,1),b(e.subclass,function(e){g(e.bindings,t)>-1&&!a.call(e[n],t)&&e.removeBoundProperty(t)}),F(e,t)},onInit:function(e,t){var r=t.bindings||null;if(r===null||r.length===0)return;b(r,function(r){_(e,r,function(){var i=m(arguments);return i.unshift(this),t[n][r].apply(e,i)})})}});var q=I({init:function(e,t,n){if(!e)throw Error("Cannot create Observer without class context.");this.context=e,this.name=t,this.events=[],this.writable=!0,this.delay=0,this._debounce=null,n!==null&&typeof n=="object"?(this.getter=f(n.get)?n.get:null,this.setter=f(n.set)?n.set:null,this.value=n.value,this.writable=typeof n.writable=="boolean"?n.writable:!0,this.delay=typeof n.delay=="number"?n.delay:0):this.value=n},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(e){var t=this.value,n=this.context;return this.writable?(this.value=this.setter?this.setter.call(n,e,t):e,this.value!==t&&this.emit(),n):n},emit:function(){var t=this,n=m(arguments);return this.delay>0?(this._debounce!==null&&e.clearTimeout(this._debounce),this._debounce=e.setTimeout(function(){t._debounce=null,t._triggerEmit(n)},this.delay)):this._triggerEmit(n),this.context},_triggerEmit:function(e){var t=0,n=this.events.length,r=this.context,i=this.events;e.unshift(this.value);for(;t<n;++t)i[t].apply(r,e)},addListener:function(e){if(!f(e))throw Error("Observer.addListener only takes instances of Function");return this.events[this.events.length]=e,this.context},once:function(e){if(!f(e))throw Error("Observer.once only takes instances of Function");var t=this,n=function(){t.removeListener(n),e.apply(this,arguments)};return n.listener=e,this.addListener(n),this.context},removeListener:function(e){if(!f(e))throw Error("Observer.removeListener only takes instances of Function");var t=this.context,n=this.events,r=-1,i=0,s=n.length;for(;i<s;++i)if(n[i]===e||n[i].listener&&n[i].listener===e){r=i;break}return r<0?t:(n.splice(i,1),t)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}});q[n].on=q[n].addListener,H("observable",{onCreate:function(e,t){var n=this;e.observable=S({},t.observable||{}),e.addObservableProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeObservableProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){e.observable[n]=r,b(e.subclass,function(e){a.call(e.observable,n)||e.addObservableProperty(n,r)})},onPropRemove:function(e,t){var n=e.observable[t];b(e.subclass,function(e){e.observable[t]===n&&e.removeObservableProperty(t)}),e.observable[t]=null;try{delete e.observable[t]}catch(r){}},onInit:function(e,t){var n,r=t.observable||null;if(r===null)return;for(n in r)a.call(r,n)&&_(e,n,new q(e,n,r[n]))}});var R={},U="GLOBAL",z,W,X,V,$=function(e,t){return b(e,function(e){t[e]||(t[e]={}),t=t[e]}),t},J=function(e,t,n){if(typeof t=="string"){n=e[t]||V().get(t)||null;if(!n)throw Error("Invalid parent class ["+t+"] specified.");return n}return c(t)?w(t,function(t){return J(e,t)}):t},K=I({init:function(e){this.ref={},this.name=e},create:function(){var e=m(arguments),t=e.shift(),r=t.split("."),i=r.pop(),s=this,o=$(r,s),u=s.ref,a=I.apply(null,w(e,function(e){return J(u,e)}));return a._name_=i,a._namespace_=t,a.extend=a[n].extend=function(){return I.apply(null,[a].concat(w(arguments,function(e){return J(u,e)})))},a.getNamespace=function(){return s},a.toString=function(){return"[object "+t+"]"},o[i]=a,u[t]=a,a},destroy:function(e){var t,n=e.split("."),r=n.pop(),i=this,s=this,o=this.ref;return b(n,function(e){if(!s[e])return s=null,!1;s=s[e]}),s?(t=s[r],t?(b(t.subclass,function(e){i.destroy(e._namespace_)}),t.superclass.subclass&&(t.superclass.subclass=E(t.superclass.subclass,t)),b(o,function(t,n){n!==e&&n.indexOf(e)===0&&i.destroy(t._namespace_)}),delete s[r],delete o[e],this):this):this},exists:function(e){return!!this.ref[e]},get:function(e,t){return f(t)?(this.ref[e]?t(this.ref[e]):this.load(e,t),this):this.ref[e]||this.name!==U&&V().get(e)||null},load:function(e,t){return t&&t(this.ref[e]||null),this},setAutoloader:function(e){if(!f(e))throw Error("Namespace.setAutoloader only takes instances of Function");return this.load=e,this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});z=function(e){return e instanceof K?e:(e=e||U,R[e]||(R[e]=new K(e)),R[e])},W=function(e){e instanceof K&&(e=e.name);if(e===U)return;delete R[e]},X=function(e){var t=e.split("."),n=t.length,r;while((r=t.slice(0,n--).join("."))!=="")if(R[r])return R[r];return null},V=function(){return z(U)};var Q="/",G=I({invoke:function(){var e=m(arguments),t=e.length,n,r;if(t===0)return z();if(typeof e[0]=="string")return t===1?(r=e[0].split(Q),n=z(r[0]),r[1]?n.get(r[1]):n):t===2&&typeof e[1]=="string"?z(e[0]).get(e[1]):(r=e.shift().split(Q),n=z(r[0]),r[1]&&e.unshift(r[1]),n.create.apply(n,e));return I.apply(null,e)},init:function(){var e=m(arguments),t,n;if(e.length<1)throw Error("Classify object cannot be instantiated!");return t=c(e[e.length-1])?e.pop():[],n=G.invoke.apply(null,e),n.__isclass_?n.applicate(t):n}});S(G,{version:"0.9.10",create:I,Namespace:K,getNamespace:z,destroyNamespace:W,testNamespace:X,getGlobalNamespace:V,Observer:q,addMutator:H,removeMutator:B,global:V(),extend:S,provide:function(t,n){return $(t.split("."),n||e||{})}});if(typeof module!="undefined"&&module.exports)module.exports=G,G.Classify=G;else if(typeof e.define=="function"&&e.define.amd)e.define("classify",function(){return G});else{var Y=e.Classify;e.Classify=G,G.noConflict=function(){return Y===t?delete e.Classify:e.Classify=Y,G}}})(this);